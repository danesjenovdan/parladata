apiVersion: batch/v1
kind: Job
metadata:
  name: parlameter-update-flow
spec:
  schedule: "0 1 * * *"
  template:
    metadata:
      name: parlameter-update-flow
    spec:
      initContainers:
      # - name: parser
      #   image: parlaparser-ljubljana
      #   command: ['scrapy', 'crawl', 'sessions']
      #   envFrom:
      #     - secretRef:
      #         name: parlaparser-ljubljana-credentials
      #   env:
      #     - name: PARSER_MANDATE_START_DATE
      #       value: '2018-12-15'
      #     - name: PARSER_MAIN_ORG_ID
      #       value: '1'
      #     - name: PARSER_MANDATE_ID
      #       value: '1'
      - name: run-tfidf
        image: parladata
        command: ['manage.py', 'set_tfidf']
        env:
          - name: DJANGO_SETTINGS_MODULE
            value: parladata_project.settings.k8s
        envFrom:
          - secretRef:
              name: parladata-credentials
      - name: set-results
        image: parladata
        command: ['manage.py', 'set_votes_result', '--majority', 'relative_normal']
        env:
          - name: DJANGO_SETTINGS_MODULE
            value: parladata_project.settings.k8s
        envFrom:
          - secretRef:
              name: parladata-credentials
      - name: tagger
        image: parladata
        command: ['manage.py', 'set_motion_tags']
        env:
          - name: DJANGO_SETTINGS_MODULE
            value: parladata_project.settings.k8s
        envFrom:
          - secretRef:
              name: parladata-credentials
      - name: pair-votes-with-speeches
        image: parladata
        command: ['manage.py', 'pair_votes_and_speeches']
        env:
          - name: DJANGO_SETTINGS_MODULE
            value: parladata_project.settings.k8s
        envFrom:
          - secretRef:
              name: parladata-credentials
      # job requires at least one container
      containers:
      - name: job-done
        image: busybox
        command: ['sh', '-c', 'echo "parlameter-update-flow done"']
    
      restartPolicy: Never
